<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{% block title %}Admin - Mini Mart{% endblock %}</title>
  <link rel="stylesheet" href="/static/css/bootstrap.min.css">
  <style>
    /* Cafe theme */
    body {
      background: #f5f0e1;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    nav.navbar {
      background: #6f4e37 !important;
      color: #fff;
    }

    nav.navbar .navbar-brand {
      color: #fff;
      font-weight: bold;
    }

    nav.navbar .btn-outline-danger {
      color: #fff;
      border-color: #fff;
    }

    nav.navbar .btn-outline-danger:hover {
      background: #fff;
      color: #6f4e37;
    }

    .sidebar {
      background: #d9c4a5;
      min-height: 100vh;
      width: 220px;
      padding: 20px 10px;
    }

    .sidebar .nav-link {
      color: #4b3621;
      margin: 5px 0;
      font-weight: 500;
    }

    .sidebar .nav-link:hover {
      background: #cbb195;
      border-radius: 5px;
    }

    .content-area {
      padding: 30px;
      flex: 1;
    }

    .card {
      border-radius: 12px;
      box-shadow: 0 4px 6px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body>
<nav class="navbar navbar-expand-lg">
  <span class="navbar-brand">Mini Mart Admin</span>
  <div class="ml-auto d-flex align-items-center">
    <span id="username" class="mr-3"></span>
    <!-- Logout as hyperlink -->
    <a href="#" id="logoutLink" style="color: #fff; text-decoration: underline;">Logout</a>
  </div>
</nav>


<div class="d-flex">
  <div class="sidebar">
    <ul class="nav flex-column">
      <li class="nav-item"><a class="nav-link" href="/admin/dashboard">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="/admin/products">Products</a></li>
      <li class="nav-item"><a class="nav-link" href="/admin/categories">Categories</a></li>
    </ul>
  </div>

  <div class="content-area">
    {% block content %}{% endblock %}
  </div>
</div>

{% block scripts %}
<script>
  async function checkAdmin() {
    try {
      const res = await fetch("/api/admin/check", {
        method: "GET",
        credentials: "include"
      });
      if (!res.ok) {
        alert("Unauthorized: Admins only");
        window.location.href = "/";
      } else {
        const data = await res.json();
        if(data.username) {
          document.getElementById("username").innerText = data.username;
        }
      }
    } catch(err) {
      console.error(err);
      alert("Error verifying admin access");
      window.location.href = "/";
    }
  }
  checkAdmin();

  const logoutBtn = document.getElementById("logoutBtn");
  if(logoutBtn){
    logoutBtn.addEventListener("click", async () => {
      try {
        const res = await fetch("/api/auth/logout", {
          method: "POST",
          credentials: "include"
        });
        if(res.ok){
          window.location.href = "/";
        } else {
          console.error("Logout failed");
        }
      } catch(err) {
        console.error("Logout error", err);
      }
    });
  }
</script>
{% endblock %}
</body>
</html>
